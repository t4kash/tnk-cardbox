(function(){"use strict";var a,b;a="4ofkpZSUMjDDFQowUnV7rrdTPb01XXhuKncyQt5b",b="BSr5oeZvUrD3ZZZly8W170VQ81A9Q0stDU0f61iL",Parse.initialize(a,b),angular.module("tnkCardboxApp",["ngRoute","ngCsv"]).config(["$routeProvider",function(a){return a.when("/",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/main",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}])}).call(this),function(){"use strict";angular.module("tnkCardboxApp").controller("LoginCtrl",["$scope","$location",function(a,b){return Parse.User.current()?void b.path("/main"):(a.processing=!1,a.login=function(b){return b.$invalid?void 0:(a.processing=!0,Parse.User.logIn(a.loginId,a.loginPassword,{success:function(){return a.gotoMain()},error:function(b,c){return console.log(c),alert(c.code===Parse.Error.OBJECT_NOT_FOUND?"IDもしくはパスワードのエラー":"ログインできません:"+c.code),a.$apply(function(){return a.processing=!1})}}))},a.userRegistration=function(b){return!b.$invalid&&confirm("ユーザー登録を行いますか？")?Parse.User.signUp(a.loginId,a.loginPassword,{ACL:new Parse.ACL},{success:function(){return a.gotoMain()},error:function(a,b){return console.log(b),alert(b.code===Parse.Error.USERNAME_TAKEN?"すでに使用されているIDです":"登録エラー:"+b.code)}}):void 0},a.gotoMain=function(){return a.$apply(function(){return b.path("/main"),a.processing=!1})})}])}.call(this),function(){"use strict";angular.module("tnkCardboxApp").controller("MainCtrl",["$scope","$location","cardAttribute","rarityFilter",function(a,b,c,d){return a.logout=function(){return Parse.User.logOut(),b.path("/")},Parse.User.current()?(a.prefectures=c.prefectures,a.regions=c.regions,a.cardTypes=c.cardTypes,a.rarities=c.rarities,a.items=[],a.filteredItems=[],a.loading=!1,a.predicateColumn="attack",a.predicate="attack",a.reverse=!0,a.fetchCardList=function(){var b,c;return a.loading=!0,a.items=[],b=Parse.Object.extend("Card"),c=new Parse.Query(b),c.limit(1e3),c.equalTo("user",Parse.User.current()),c.find({success:function(b){return console.log("total: "+b.length),a.$apply(function(){var c,d,e,f;for(a.items=[],e=0,f=b.length;f>e;e++)d=b[e],c=angular.copy(d.attributes),c.id=d.id,c.selected=!1,a.items.push(c);return a.loading=!1})},error:function(b){return console.log(b.code+" "+b.message),b.code===Parse.Error.OBJECT_NOT_FOUND&&a.logout(),a.$apply(function(){return a.loading=!1})}})},a.fetchCardList(),a.sort=function(b){return b===a.predicateColumn?a.reverse=!a.reverse:(a.predicateColumn=b,a.predicate="rarity"===b?function(a){return c.rarities.indexOf(d(a.rarity))}:b,a.reverse=!1)},a.sortClass=function(b){return b!==a.predicateColumn?"fa-sort":a.reverse?"fa-sort-desc":"fa-sort-asc"},a.strictComparator=function(a,b){return""===b?!0:angular.equals(b,a)},a.regionFilterFunc=function(b){return null==a.searchRegion||""===a.searchRegion?!0:a.searchRegion===c.regionByPrefecture(b.region)},a.rarityFilterFunc=function(b){return null==a.searchRarity||""===a.searchRarity?!0:a.searchRarity===d(b.rarity)},a.toggleAll=function(){return angular.forEach(a.filteredItems,function(b){return b.selected=a.checkboxAll})},a.deleteCard=function(){var b,c,d,e,f,g;for(b=[],g=a.items,e=0,f=g.length;f>e;e++)c=g[e],c.selected&&b.push(c.id);if(0===b.length)alert("削除するカード情報を選択してください");else if(!confirm(b.length+"件のカード情報を削除します"))return;return a.loading=!0,d=new Parse.Query("Card"),d.limit(1e3),d.containedIn("objectId",b),d.equalTo("user",Parse.User.current()),d.find().then(function(b){var c;return c=Parse.Promise.as(),angular.forEach(b,function(b){return c=c.then(function(){return angular.forEach(a.items,function(c,d){return c.id===b.id?a.$apply(function(){return a.items.splice(d,1)}):void 0}),b.destroy()})}),c.always(function(){return a.$apply(function(){return a.loading=!1})})})},a.csvData=function(){var b;return b=[],angular.forEach(a.filteredItems,function(a){return b.push({name:a.name,nameKana:a.nameKana,rarity:d(a.rarity),region:a.region,level:a.level,maxLevel:a.maxLevel,extendLevel:a.extendLevel,cost:a.cost,attack:a.attack,defence:a.defence,type:a.type,skill:a.skill,skillLevel:a.skillLevel,skillName:a.skillName})}),b}):void a.logout()}])}.call(this),function(){"use strict";angular.module("tnkCardboxApp").service("cardAttribute",function(){return this.prefectures=["北海道","青森","岩手","宮城","秋田","山形","福島","茨城","栃木","群馬","埼玉","千葉","東京","神奈川","新潟","富山","石川","福井","山梨","長野","岐阜","静岡","愛知","三重","滋賀","京都","大阪","兵庫","奈良","和歌山","鳥取","島根","岡山","広島","山口","徳島","香川","愛媛","高知","福岡","佐賀","長崎","熊本","大分","宮崎","鹿児島","沖縄"],this.regions=["北海道・東北","関東","中部","近畿","中国・四国","九州・沖縄","無所属"],this.regionMap={"北海道・東北":"北海道・東北","関東":"関東","中部":"中部","近畿":"近畿","中国・四国":"中国・四国","九州・沖縄":"九州・沖縄","無所属":"無所属","北海道":"北海道・東北","青森":"北海道・東北","岩手":"北海道・東北","宮城":"北海道・東北","秋田":"北海道・東北","山形":"北海道・東北","福島":"北海道・東北","茨城":"関東","栃木":"関東","群馬":"関東","埼玉":"関東","千葉":"関東","東京":"関東","神奈川":"関東","新潟":"中部","富山":"中部","石川":"中部","福井":"中部","山梨":"中部","長野":"中部","岐阜":"中部","静岡":"中部","愛知":"中部","三重":"近畿","滋賀":"近畿","京都":"近畿","大阪":"近畿","兵庫":"近畿","奈良":"近畿","和歌山":"近畿","鳥取":"中国・四国","島根":"中国・四国","岡山":"中国・四国","広島":"中国・四国","山口":"中国・四国","徳島":"中国・四国","香川":"中国・四国","愛媛":"中国・四国","高知":"中国・四国","福岡":"九州・沖縄","佐賀":"九州・沖縄","長崎":"九州・沖縄","熊本":"九州・沖縄","大分":"九州・沖縄","宮崎":"九州・沖縄","鹿児島":"九州・沖縄","沖縄":"九州・沖縄"},this.cardTypes=["妖怪","名物","飲食","神秘","武人","偉人","知性派","姫","伝承","お雑煮"],this.rarities=["SP","SSR","SR","HR","R","HN","N"],this.regionByPrefecture=function(a){return this.regionMap[a]},this})}.call(this),function(){"use strict";angular.module("tnkCardboxApp").filter("rarity",function(){return function(a){var b;return b={normal:"N",rare:"R",hrare:"HR",srare:"SR",ssrare:"SSR",special:"SP"},b[a]}})}.call(this);